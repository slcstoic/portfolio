# Dynamically generated by Chef - local modifications will be overwritten

# Minimal nginx service configuration.

user <%= @run_user %><%= " #{@run_group}" unless @run_group.nil? %>;

worker_processes <%= @worker_processes.nil? ? 'auto' : @worker_processes %>;

error_log /var/log/<%= @nginx_instance_name %>/error.log <%= @error_log_level %>;
pid /var/run/<%= @nginx_instance_name %>.pid;


events {
  worker_connections 1024;
}

http {
        log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                        '$status $body_bytes_sent "$http_referer" '
                        '"$http_user_agent" "$http_x_forwarded_for"';

        access_log /var/log/<%= @nginx_instance_name %>/access.log main;
        root /var/www/customers/public_html;
        index index.html

      keepalive_timeout  65;

    <% @xtra_main_http_conf.each do |key, value| -%>
    <%= key %> <%= value %>;
    <% end unless @xtra_main_http_conf.nil? -%>

    server {
      listen  8888;
      #listen [::]:8888 ipv6only=on;

      # Make site accessible from http://localhost/
      server_name localhost;
      location / {      
        root /var/www/customers/public_html;
        index index.html;     

        # First attempt to serve request as file, then
        # as directory, then fall back to displaying a 404.
        try_files $uri $uri/ =404;
        }
    }
}
  # All other directives should be placed in these directories
  include /etc/<%= @nginx_instance_name %>/conf.d/*.conf;
  include /etc/<%= @nginx_instance_name %>/sites-enabled/*;